function getCookie(name){let v=null;if(document.cookie&&document.cookie!==''){const a=document.cookie.split(';');for(let i=0;i<a.length;i++){const c=a[i].trim();if(c.substring(0,name.length+1)===(name+'=')){v=decodeURIComponent(c.substring(name.length+1));break;}}}return v;}const csrftoken=getCookie('csrftoken');async function jsonFetch(url,opts={}){const h=Object.assign({'Accept':'application/json'},opts.headers||{});if((opts.method||'GET').toUpperCase()!=='GET'){h['X-CSRFToken']=csrftoken;}const res=await fetch(url,Object.assign({},opts,{headers:h}));if(!res.ok){const t=await res.text().catch(()=> '');throw new Error(t||(res.status+' '+res.statusText));}const ct=res.headers.get('content-type')||'';return ct.includes('application/json')?res.json():res.text();}
